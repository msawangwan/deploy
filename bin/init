#!/bin/sh

CONTAINERNAME="ci.io.root"
CONTAINERVERSION="dev"

DFDIR="build"
DF="start.Dockerfile"

echo "ci.io init phase ..."; echo

cd ..

echo "root dir:"; echo; pwd

APPVERSION="$(/bin/cat conf/globals.json | grep version)"

echo "version:"; echo $APPVERSION; echo
echo "build:"; echo

DFPATH="$DFDIR/$DF"
CONTAINERTAG="$CONTAINERNAME:$CONTAINERVERSION"

docker system prune -f
docker build -f "$DFPATH" -t "$CONTAINERTAG" .
docker run --rm -it --name ci.io.root -v /var/run/docker.sock:/var/run/docker.sock ci.io.root:dev
